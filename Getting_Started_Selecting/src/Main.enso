from Standard.Base import all
from Standard.Table import all
from Standard.Database import all
from Standard.AWS import all
from Standard.Google_Api import all
import Standard.Visualization

## ![image](eags.png)

   # Selecting and Joining Data

   **This exercise is available on the Enso Community at <<<https://community.ensoanalytics.com/c/enso-analytics-101/>>>. Working through the exercises on Community lets you to keep track of your progress, and allows you to open the exercise on a second screen.**

   ### IT IS HIGHLY RECOMMENDED THAT YOU EXPERIENCE THIS EXERCISE BY USING THE LEARNING PATH ON ENSO COMMUNITY!

   This is the last in a series of four (4)  Exercises designed to help you quickly master Enso Analytics. Each Exercise is broken up in to a number of learning objectives.


   Start with Excel basics and visual components, then advance through aggregations, data cleaning, and multi-sheet integration. Each exercise tackles common business scenarios‚Äîfrom messy data cleanup to customer analysis across multiple datasets.


   By completion, you'll have the confidence to handle your organization's data challenges. 


   Users who complete these four exercises before jumping into their first real use case are over **10 times more likely to be successful**.


   The [Enso Community](<https://community.ensoanalytics.com>) provides advanced workflows for continued growth beyond these foundational skills.

   > **Note:** This example assumes you have completed Exercises 1, 2, and 3 which have very detailed instructions on how to add and configure new components, how to open each components visualization panel, how to move and reconnect components and more.If you haven't completed these exercises, and the instructions are not sufficient here, we highly recommend you start with these three exercises.


   ## Goal
   In this exercise, you will read an Excel workbook containing three (3) worksheets that contain connected information about bank customers.¬† 


   Your goal is to create a summary of information about the Savings Accounts that includes:

   account_id | open_date | created_date | last_updated_date | active_passive | Base Rate


   You will join the Customers, Accounts and ECBRates worksheets together to solve this exercise.¬†

   # **Objective 1:**¬† Prepare the Account data

   We only want to consider records that are Savings Accounts, and we only need two columns, as we will be joining data from the Customers and ECBRates worksheets in later steps.

   ## Step 1 of 4 - Read the Excel Workbook

   - In the toolbar at the top of the canvas, click on the¬†**+ Input**¬†button to add a new Input Component. This will open the Input Component Browser.
   - In the component browser, Choose the¬†***Data.read***¬†component by clicking on its name.
   - Click on the word¬†*path*¬†that is highlighted in royal blue on the¬†***Data.read***¬†component.
   - Click on¬†*Choose file...*
   - Navigate to your Documents/enso-projects/Samples/Data folder.
   - Choose the file named¬†**Customer_Data.xlsx.**
   - 
   ## Step 2 of 4- Add a new component after the ***Data.read*** component.

   - Add a ***read*** component to the ***Data.read*** component
   - Click on the ‚Äúquery‚Äù argument
   - Select the **Accounts** sheet

   ## Step 3 of 4- Filter to the Savings Account products by adding a new component after the ***read*** component.

   - Choose the ***filter*** component
   - Click on the column argument
   - Select the **product_name** column
   - Click on the filter argument
   - Select the Equals option
   - Click on the ‚Äúto‚Äù argument
   - Select the <Text Value> option
   - Click into the ‚Äú ‚Äú argument
   - Type ‚ÄúSavings Account‚Äù (case sensitive)
   You should see **Total Row Count: 1026** at the bottom of the ***filter*** component‚Äôs table visualization.

   ![Image](/images/image.png)

   ## Step 4  of 4 - Select 3 columns by adding a new component after the ***filter*** component.

   - Add a ***select_columns*** component to the ***filter*** component.
   - Select the **account_id** and **open_date** columns.
   ![Image](/images/image_1.png)
   > **Note:** The ***select_columns*** component also enables you to re-order the columns. Select them in the order that you want them to appear, and then click on the ‚Äòreorder columns‚Äô button in the components visualization.

   ### **üéâü•≥üéàCONGRATULATIONS! You have created a filtered table with just two columns from the Accounts worksheet.**

   - You also learned a new way to read Excel Worksheets from an Excel Workbook. Previously, you double clicked on the Worksheet‚Äôs name from the visualization on the ***Data.read*** that opened the Excel Workbook.
   - You learned how to select columns, and learned that you can reorder columns using the ***select_columns*** component.



   # **Objective 2:**¬† Read the Customers data

   1Ô∏è‚É£¬†¬†¬†¬†¬†¬†¬† Add a new component after the ***Data.read*** component by either dragging from the output port (the bottom edge) of the ***Data.read*** component, or clicking the ‚ûï button on the component.

   - Choose the ***read*** component
   - Click on the query argument
   - Select the **Customers** sheet

   ### 

   ## **Objective 3:**¬† Join the Accounts (Left) and the Customers (Right) data together

   - Add a ***join*** component after the ***select_columns*** component which contains our filtered Accounts data.
   - Connect the outgoing data from the ***read*** component (Customers) by dragging from the output port (the bottom edge) of the ***read*** component to the royal blue **right** argument on the ***join*** component. (see animation below)
   - - Choose the join_kind of **..Inner** (more on [Enso Join Options](<https://help.enso.org/docs/api/Standard.Table/Table/Table.join/)).>
   - Click on the on (‚ûï) and accept the **account_id**(1st field) column
   - Click on the right argument and select the **acct_id** column

   > **NOTE:** in the screenshot below, the ***read*** component with the **Customers** worksheet is connected to the ***Data.read*** at the top of the workflow.

   ![Image](/images/join-connect.gif)




   ## Step 3 - Remove the acct_id column
   - Add a ***remove_columns*** component following ***join*** component
   - Choose the **acct_id column**
   You should now have **1026 rows** with columns: **account_id, open_date, created_date, last_updated_date, active_passive.**


   ![Image](/images/image_3.png)
   > **Note:**¬† You can select_columns and choose all desired columns or use the remove_columns component and de-select the one unnecessary column.

   ### **üéâü•≥üéàCONGRATULATIONS! You have joined two tables and removed columns using two different methods!**
   - You also learned how to connect the output of one component (the ***read*** component with the Customer data) as an input to the **right** argument on the Accounts data in the join.



   ## Objective 3:¬† Joining your data to the ECB Rates

   The ECB rates are provided as a table of **Start Date**, **End Date**, and **Rate.** The final task is to join the result from Objective 2 to these rates.¬†

   There is a challenge in using the ECB data.¬† The use of the table reads each row as follows:¬† Date greater than or equal to **StartDate** until **EndDate**.¬† In this definition of the table, there is a redundancy where each **StartDate** is equal to the prior period‚Äôs **EndDate**. We will fix this issue and then will join the rates to the output from Objective 2.

   ![Image](/images/image_6.png)

   ## Step 1 of 3 - Add a new ***read*** component after the ***Data.read*** component

   - Add a¬†***read***¬†component to the ***Data.read*** component
   - Click on the query argument
   - Select the **ECBRates** sheet

   ## Step 2 of 3 - Add a ***set*** component to the output of the ***read*** component (to subtract 1 day from the **EndDate**)

   - Click on the value argument and select the <Simple Expression> option
   - Click on the input argument and select the **EndDate** column
   - Click on the operation argument and select the ‚ÄúDate" option.
   - Click on the operation argument and select the ‚Äúadd" option.
   - Click on the length argument and select the ‚ÄúNumber Value‚Äù option
   - Type ‚Äú-1‚Äù into the argument
   - Click on the period argument and select the ‚ÄúDay‚Äù option
   - Type ‚ÄúEndDate‚Äù in the ‚Äòas‚Äô argument
   - Check your results to see non-overlapping date ranges, as below
   ![Image](/images/image_4.png)

   ## Step 3 of 3 - Join the Accounts and Customers data from Exercise 2 to the adjusted ECB Rates data

   - Add a new ***join*** component to the ***remove_columns*** that contains the Account and Customer data that was previously joined together
   - Connect the data from the ***set*** component into the right argument in the ***join*** component
   - Click on the *join_kind* argument and select the ‚ÄúInner‚Äù option
   - Click on the ‚ûï button (on +)
   - Click on the Equals (default) and select ‚ÄúBetween‚Äù
   - Click on the *left* argument and select **open_date**
   - Click on the *right_lower* argument and select **StartDate**
   - Click on the *right_upper* argument and select **EndDate**
   ![Image](/images/image_5.png)

   ### **üéâü•≥üéàCONGRATULATIONS! You have added the interest rate from the ECBRates sheet to the Accounts and Customer Data!**

   - You used join_between to match rates between two dates! In this case, you added the rate that was in effect at the date that the account was opened. This capability is unique relative to other data preparation platforms.
   - You adjusted a date by subtracting one day to create overlapping ranges. Date arithmetic is possible because the **open_date column** is a **date** type.

   # **Objective 4:**¬† Final data preparation

   You‚Äôll want to remove unnecessary columns, followed by renaming of Interest Rate and finally the filtering to only ‚ÄúActive‚Äù accounts.

   ## Step 1 of 3 - Remove the **StartDate** and **EndDate** columns.

   - Add a ***remove_columns*** component to the ***join*** component that added the ECBRates to the Account and Customer data
   - Choose the **StartDate** and **EndDate** columns
   You should still have 1026 rows with columns: **account_id, open_date, created_date, last_updated_date, active_passive, StartDate, EndDate** and **InterestRate**.

   ## Step 2 of 3 - Rename the **InterestRate** column to **Base Rate**

   - Add a new ***rename_columns*** component after the ***remove_columns*** component
   - Click on the ‚ûï button (on +)
   - Click on the ‚Äúaccount_id‚Äù (default 1st column) and select the **InterestRate** column
   - Click on the ‚ÄúNew Name‚Äù (default) and type ‚ÄúBase Rate‚Äù as replacement text

   ## Step 3 of 3 - Filter to the active accounts

   - Add a new ***filter*** component after the ***rename_columns*** component
   - Click on the column argument
   - Select the **active_passive** column. The default argument is ***is_true*** so there is no requirement to enter this, but readability is enhanced by adding this argument
   - Check to see how many rows of data are present in your visualization

   ### 
   ### **You should now have 676 rows with columns: account_id, open_date, created_date, last_updated_date, active_passive, StartDate, EndDate and Base Rate.**
   ![Image](/images/image_7.png)
   ### **üéâü•≥üéàCONGRATULATIONS! You have completed Enso Analytics Getting Started!!!**
   - You have now built a solid understanding of how Enso works, its user interface, and our most frequently used components!
main =
    operator1 = "Selecting and Joining Data"



#### METADATA ####
[[{"index":{"value":11488},"size":{"value":28}},"96ab67a9-9096-4751-a2d2-e679f07870d7"]]
{"ide":{"node":{"96ab67a9-9096-4751-a2d2-e679f07870d7":{"position":{"vector":[46,732]}}},"widget":{},"snapshot":"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","import":{}}}